{{define "body"}}
{{$ctx := . }}
<div class="container">
	<div class="row row-centered">
		<div class="col-xs-12 col-sm-4">
			<div id="jstree_div"></div>
		</div>
		<div class="col-xs-12 col-sm-8">
			<table class="table table-hover table-bordered table-condensed" id="table-files-browser">
				<thead>
					<tr>
						<th>Filename</th>
						<th>Size</th>
						<th>Date</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
	</div>

	<div class="row">
		<div class="col-md-6">
			<h2>Upload</h2>
			<form action="{{namedurl "files-upload"}}" method="post" enctype="multipart/form-data" class="form-inline">
				<input type="file" name="upload" />
				<input type="submit" value="Start upload" class="btn btn-primary btn-sm"/>
				<input type="hidden" name="BasePageContext.CsrfToken" id="" value="{{.CsrfToken}}" />
				<input type="hidden" name="p" id="" value="{{.Path}}" />
			</form>
		</div>
		<div class="col-md-6">
			<h2>Create directory</h2>
			<form action="{{namedurl "files-mkdir"}}" method="post" class="form-inline">
				<input type="text" name="name" placeholder="Directory name" required />
				<input type="submit" value="Mkdir"  class="btn btn-primary btn-sm"/>
				<input type="hidden" name="BasePageContext.CsrfToken" id="" value="{{.CsrfToken}}" />
				<input type="hidden" name="p" id="" value="{{.Path}}" />
			</form>
		</div>
	</div>
</div>

<script src="/static/lib/jquery/jstree.js" type="text/javascript" ></script>
<script src="/static/lib/jquery/jquery.dataTables.js" type="text/javascript"></script>
<script src="/static/lib/dataTables.bootstrap.js" type="text/javascript"></script>
<script type="text/javascript">

	$(function() {
		var table = $('table').dataTable({
			"bAutoWidth": false,
			"bStateSave": true,
			"sPaginationType": "bootstrap",		
			"iDisplayLength": 15,
			"aLengthMenu": [[15, 25, 50, 100, -1], [15, 25, 50, 100, "All"]],
			"aoColumnDefs": [
				{
					"aTargets": [0],
					"mData": null,
					"mRender": function(data, type, full) {
						return ['<span class="glyphicon glyphicon-file"></span>',
							'<a href="?p=', full[3], '">', full[0], '</a>'].join("");
					},
				},
			],
		});

		function selectPath(path) {
			$.ajax({
				url: "serv/files",
				data: {
					id: path,
				},
				cache: true,
				dataType: "json"
			}).done(function(msg) {
				table.fnClearTable();
				table.fnAddData(msg);
			});
		}

		$('#jstree_div').jstree({
			'core' : {
				'data' : {
					'url' : function (node) {
						return 'serv/dirs';
					},
					'data' : function (node) {
						return { 'id' : node.id };
					}
				}
			}
		}).on("select_node.jstree", function (e, data) {
			selectPath(data.selected[0]);
		});

		selectPath("dt--root");
	});
</script>
{{end}}

